@page "/"
@using DUPSS.API.Models.Objects
@using DUPSS.Web.Components.Service
@inject IJSRuntime JS
@inject BlogTopicApiService BlogTopicApiService
<PageTitle>Home</PageTitle>

@* Demo for Blazor Server with Supabase Authentication *@

@* <AuthorizeView>
    <Authorized>
        <h3>Hello, @context.User.FindFirst(System.Security.Claims.ClaimTypes.Name)?.Value</h3>
        <p>Role: @context.User.FindFirst(System.Security.Claims.ClaimTypes.Role)?.Value</p>
    </Authorized>
    <NotAuthorized>
        <h3>Welcome, Guest! Please <a href="/login">log in</a> to personalize your experience.</h3>
    </NotAuthorized>
</AuthorizeView> *@

<div class="container-fluid px-5 py-4">
    <section class="hero-section">
        <div class="hero-content">
        </div>

        <div class="hero-card">
            <h2>A Journey of Overcoming Temptation</h2>
            <p class="quote">"A heartfelt story and reflection on resisting the temptation of drugs, finding strength from within, and building a life of purpose beyond addiction."</p>


            <NavLink href="/Blog/Detail/B0004" class="btn-read-story">
                READ THE STORY <span class="arrow">→</span>
            </NavLink>
        </div>

    </section>

    <div class="row ">
        <div class="col-md-3 blog-topics">
            <h5 class="fw-semibold mb-5" style="color: #1b6ec2">Blog Topics</h5>
            <ul class="list-unstyled">
                @foreach (var topic in BlogTopics)
                {
                    <li class="py-2">@topic.BlogTopicName</li>
                }
            </ul>
        </div>

        <div class="col-md-9 blog-card">
            <h6 class="text-primary mb-3">Trending Topics</h6>
            <div class="d-flex flex-column gap-5 ">

                <div class="col-md-10">
                    <div class="card h-100 shadow-sm">
                        <div class="row g-5">
                            <div class="col-md-8 order-md-1">
                                <div class="card-body">
                                    <h5 class="card-title">Know the Facts: How Education Can Prevent Drug Abuse</h5>
                                    <p class="card-text text-muted">Misinformation fuels risky behavior. Learn how
                                        evidence-based drug education in schools and communities empowers young people
                                        to make informed, healthy choices.</p>
                                    <span class="badge bg-secondary">Education</span>
                                    <div class="mt-2 text-muted small">By Mark Tuchel • <span style="color: #0892ff;">7 min read</span>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-4 order-md-2">
                                <img src="images/1.jpg" class="img-fluid h-100" style="object-fit: cover;" alt="...">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-10">
                    <div class="card h-100 shadow-sm">
                        <div class="row g-5">
                            <div class="col-md-8 order-md-1">
                                <div class="card-body">
                                    <h5 class="card-title">Building Resilience: Protective Factors Against Substance
                                        Use</h5>
                                    <p class="card-text text-muted">Strong family bonds, peer support, and
                                        extracurricular activities can shield teens from addiction. Discover practical
                                        ways to foster resilience in your community.</p>
                                    <span class="badge bg-secondary">Health & Wellness</span>
                                    <div class="mt-2 text-muted small">By Harry Duval • <span style="color: #0892ff;">4 min read</span>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-4 order-md-2">
                                <img src="images/1.jpg" class="img-fluid h-100" style="object-fit: cover;" alt="...">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <section class="new-hero-section">
        <div class="container new-hero-container">
            <h1 class="typewrite">
                @*put letter r to enable effect*@
                Every individual and community has the ability to protect themselves from the risks of drug use and
                plays a vital role in building a healthier, safer society.

            </h1>

            <div class="image-carousel-wrapper">
                <button class="carousel-control-image prev-btn-image">
                    <span class="arrow-icon">&lt;</span>
                </button>

                <div class="carousel-image-slides">
                    <div class="carousel-image-slide active">
                        <img src="images/1.jpg" alt="Câu chuyện 1" class="carousel-image"/>
                        <img src="images/2.jpg" alt="Câu chuyện 2" class="carousel-image"/>
                    </div>

                    <div class="carousel-image-slide">
                        <img src="images/3.jpg" alt="Câu chuyện 3" class="carousel-image"/>
                        <img src="images/4.jpg" alt="Câu chuyện 4" class="carousel-image"/>
                    </div>

                </div>


                <button class="carousel-control-image next-btn-image">
                    <span class="arrow-icon">&gt;</span>
                </button>

            </div>
        </div>
    </section>


    <div class="subscribe-container">
        <div class="left">
            <h4>Stay up to date</h4>
            <h2>Get Started</h2>
            <form>
                <input type="email" placeholder="Enter your email.." required/>
                <button type="submit">Register now</button>
            </form>
            <p>*You can unsubscribe anytime</p>
        </div>
        <div class="right"></div>
    </div>

   
    <Footer />


    <script>
        window.initCarousel = () => {
            const slides = document.querySelectorAll('.carousel-image-slide');
            const prevBtn = document.querySelector('.prev-btn-image');
            const nextBtn = document.querySelector('.next-btn-image');
            let currentIndex = 0;

            function showSlide(index) {
                slides.forEach((slide, i) => {
                    if (i === index) {
                        slide.classList.add('active');
                    } else {
                        slide.classList.remove('active');
                    }
                });
            }

            function nextSlide() {
                currentIndex = (currentIndex + 1) % slides.length;
                showSlide(currentIndex);
            }

            function prevSlide() {
                currentIndex = (currentIndex - 1 + slides.length) % slides.length;
                showSlide(currentIndex);
            }

            if (prevBtn && nextBtn) {
                prevBtn.onclick = prevSlide;
                nextBtn.onclick = nextSlide;
            }
            showSlide(currentIndex);
        };
    </script>
    
</div>

@code {

    private List<BlogTopic> BlogTopics;
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await JS.InvokeVoidAsync("initCarousel");
        }
    }
    
    protected override async Task OnInitializedAsync()
    {
        // Initialize any data or services needed for the component
        // For example, fetching blog topics from an API
        BlogTopics = await BlogTopicApiService.GetAllAsync();
    }
}