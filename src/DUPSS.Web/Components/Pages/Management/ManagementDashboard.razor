@page "/Management/Dashboard"
@using DUPSS.Web.Components.Layout
@using DUPSS.Web.Components.Service
@inject JwtAuthenticationStateProvider authStateProvider
@layout ManagementLayout

<h1>Management Dashboard</h1>
@if (userName == null)
{
    <p>Loading...</p>
}
else
{
    <p>Welcome @userName to the management home page. Here you can manage various aspects of the application.</p>
}

<div class="dashboard-main-grid">
    <!-- Stats Cards -->
    <div class="dashboard-cards">
        <div class="dashboard-card">
            <div class="dashboard-card-icon bg-blue"><i class="fas fa-users"></i></div>
            <div>
                <div class="dashboard-card-title">Users</div>
                <div class="dashboard-card-value">1,234</div>
            </div>
        </div>
        <div class="dashboard-card">
            <div class="dashboard-card-icon bg-green"><i class="fas fa-calendar-check"></i></div>
            <div>
                <div class="dashboard-card-title">Appointments</div>
                <div class="dashboard-card-value">87</div>
            </div>
        </div>
        <div class="dashboard-card">
            <div class="dashboard-card-icon bg-yellow"><i class="fas fa-bullhorn"></i></div>
            <div>
                <div class="dashboard-card-title">Campaigns</div>
                <div class="dashboard-card-value">12</div>
            </div>
        </div>
        <div class="dashboard-card">
            <div class="dashboard-card-icon bg-purple"><i class="fas fa-bell"></i></div>
            <div>
                <div class="dashboard-card-title">Notifications</div>
                <div class="dashboard-card-value">5</div>
            </div>
        </div>
        <div class="dashboard-card">
            <div class="dashboard-card-icon bg-green"><i class="fas fa-book"></i></div>
            <div>
                <div class="dashboard-card-title">Courses</div>
                <div class="dashboard-card-value">8</div>
            </div>
        </div>
        <div class="dashboard-card">
            <div class="dashboard-card-icon bg-blue"><i class="fas fa-user-graduate"></i></div>
            <div>
                <div class="dashboard-card-title">Enrollments</div>
                <div class="dashboard-card-value">142</div>
            </div>
        </div>
        <!-- User Growth Mini Chart -->
        <div class="dashboard-card" style="flex-direction:column; align-items:flex-start;">
            <div style="display:flex;align-items:center;width:100%;">
                <div class="dashboard-card-icon bg-purple"><i class="fas fa-chart-line"></i></div>
                <div>
                    <div class="dashboard-card-title">User Growth</div>
                    <div class="dashboard-card-value" style="font-size:1.3rem;">+8.2% <span style="font-size:1rem;color:#22c55e;">this month</span></div>
                </div>
            </div>
            <div class="dashboard-sparkline">
                <svg width="100" height="32" viewBox="0 0 100 32">
                    <polyline fill="none" stroke="#3766ff" stroke-width="3"
                              points="0,28 15,22 30,25 45,15 60,18 75,10 90,14 100,8"
                              style="filter: drop-shadow(0 1px 3px #3766ff33);" />
                </svg>
            </div>
        </div>
    </div>

    <!-- Chart & Quick Actions & Profile -->
    <div class="dashboard-side">
        <div class="dashboard-chart-card">
            <div class="dashboard-chart-header">
                <span>Appointments Trend</span>
                <span class="dashboard-chart-period">Last 7 days</span>
            </div>
            <div class="dashboard-chart-placeholder">
                <svg width="100%" height="60" viewBox="0 0 220 60">
                    <polyline fill="none"
                              stroke="#3766ff"
                              stroke-width="4"
                              points="0,40 30,30 60,35 90,20 120,25 150,10 180,18 210,8"
                              style="filter: drop-shadow(0 2px 6px #3766ff33);" />
                </svg>
            </div>
        </div>
        <div class="dashboard-quick-actions">
            <button class="dashboard-action-btn bg-blue"><i class="fas fa-user-plus"></i> Add User</button>
            <button class="dashboard-action-btn bg-green"><i class="fas fa-calendar-plus"></i> New Appointment</button>
            <button class="dashboard-action-btn bg-yellow"><i class="fas fa-bullhorn"></i> New Campaign</button>
            <button class="dashboard-action-btn bg-purple"><i class="fas fa-book"></i> New Course</button>
        </div>
        <div class="dashboard-shortcuts">
            <h3>Quick Links</h3>
            <ul>
                <li><a href="/Management/User"><i class="fas fa-users-cog"></i> Manage Users</a></li>
                <li><a href="/Management/Appointment"><i class="fas fa-calendar-alt"></i> Manage Appointments</a></li>
                <li><a href="/Management/CourseEnroll"><i class="fas fa-user-graduate"></i> Manage Enrollments</a></li>
                <li><a href="/Management/Campaign"><i class="fas fa-bullhorn"></i> Manage Campaigns</a></li>
            </ul>
        </div>
        <!-- Profile Quick Card -->
        <div class="dashboard-profile-card">
            <div class="profile-avatar">
                <i class="fas fa-user-circle"></i>
            </div>
            <div>
                <div class="profile-name">@userName</div>
            </div>
            <button class="dashboard-action-btn bg-blue" style="margin-top:12px;font-size:1rem;padding:8px 18px;"><i class="fas fa-cog"></i> Profile</button>
        </div>
    </div>
</div>

<!-- Recent Activity & Notifications & System Health & Usage -->
<div class="dashboard-bottom-grid">
    <div class="dashboard-section">
        <h2>Recent Activity</h2>
        <ul class="dashboard-activity">
            <li><span class="activity-dot bg-blue"></span> New user registered</li>
            <li><span class="activity-dot bg-green"></span> Appointment confirmed</li>
            <li><span class="activity-dot bg-yellow"></span> Campaign launched</li>
            <li><span class="activity-dot bg-purple"></span> Notification sent</li>
        </ul>
    </div>
    <div class="dashboard-section dashboard-notifications">
        <h2>Notifications</h2>
        <ul class="dashboard-activity">
            <li><span class="activity-dot bg-purple"></span> System update scheduled</li>
            <li><span class="activity-dot bg-blue"></span> New feedback received</li>
        </ul>
    </div>
    <div class="dashboard-section dashboard-system-health">
        <h2>System Health</h2>
        <ul class="dashboard-activity">
            <li><span class="activity-dot bg-green"></span> API: <span class="status-label status-ok">Online</span></li>
            <li><span class="activity-dot bg-green"></span> Database: <span class="status-label status-ok">Connected</span></li>
            <li><span class="activity-dot bg-green"></span> Auth: <span class="status-label status-ok">Operational</span></li>
        </ul>
        <!-- System Usage Progress Bar -->
        <div class="system-usage-bar">
            <div class="system-usage-label">System Usage</div>
            <div class="system-usage-track">
                <div class="system-usage-fill" style="width: 72%;"></div>
            </div>
            <div class="system-usage-percent">72%</div>
        </div>
    </div>
    <div class="dashboard-section dashboard-top-course">
        <h2>Top Performing Course</h2>
        <div class="top-course-info">
            <div class="top-course-title"><i class="fas fa-book-open"></i> "Healthy Living 101"</div>
            <div class="top-course-meta">Enrollments: <span class="top-course-enroll">58</span> | Completion Rate: <span class="top-course-complete">92%</span></div>
        </div>
    </div>
    <div class="dashboard-section dashboard-messages">
        <h2>Recent Messages</h2>
        <ul class="dashboard-activity">
            <li><span class="activity-dot bg-blue"></span> "Great course content!" - Jane D.</li>
            <li><span class="activity-dot bg-green"></span> "Appointment system is smooth." - Mark P.</li>
            <li><span class="activity-dot bg-yellow"></span> "Would love more campaigns." - Alex T.</li>
        </ul>
    </div>
</div>

<div class="dashboard-section dashboard-tips">
    <h2>Tips & Announcements</h2>
    <ul>
        <li>Remember to review new enrollments daily for approval.</li>
        <li>Check the <a href="/Management/Campaign">Campaigns</a> page for upcoming events.</li>
        <li>Keep your profile updated for better communication.</li>
    </ul>
</div>


@code {
    private string? userName;

    protected override async Task OnInitializedAsync()
    {
        var authState = await authStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;
        if (user.Identity is not null && user.Identity.IsAuthenticated)
        {
            userName = user.Identity.Name;
        }
        else
        {
            userName = "Guest";
        }
    }
}